/*! elfer_dev_lib 2014-11-17 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):"object"==typeof exports?exports.JSONEditor=b():a.JSONEditor=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e;d=[c(1),c(2),c(3)],e=function(a,b,c){function d(a,b,e){if(!(this instanceof d))throw new Error('JSONEditor constructor called without "new".');var f=c.getInternetExplorerVersion();if(-1!=f&&9>f)throw new Error("Unsupported browser, IE9 or newer required. Please install the newest version of your browser.");arguments.length&&this._create(a,b,e)}return d.modes={},d.prototype._create=function(a,b,c){this.container=a,this.options=b||{},this.json=c||{};var d=this.options.mode||"tree";this.setMode(d)},d.prototype._delete=function(){},d.prototype.set=function(a){this.json=a},d.prototype.get=function(){return this.json},d.prototype.setText=function(a){this.json=c.parse(a)},d.prototype.getText=function(){return JSON.stringify(this.json)},d.prototype.setName=function(a){this.options||(this.options={}),this.options.name=a},d.prototype.getName=function(){return this.options&&this.options.name},d.prototype.setMode=function(a){var b,e,f=this.container,g=c.extend({},this.options);g.mode=a;var h=d.modes[a];if(!h)throw new Error('Unknown mode "'+g.mode+'"');try{var i="text"==h.data;if(e=this.getName(),b=this[i?"getText":"get"](),this._delete(),c.clear(this),c.extend(this,h.mixin),this.create(f,g),this.setName(e),this[i?"setText":"set"](b),"function"==typeof h.load)try{h.load.call(this)}catch(j){}}catch(j){this._onError(j)}},d.prototype._onError=function(a){if("function"==typeof this.onError&&(c.log("WARNING: JSONEditor.onError is deprecated. Use options.error instead."),this.onError(a)),!this.options||"function"!=typeof this.options.error)throw a;this.options.error(a)},d.registerMode=function(a){var b,e;if(c.isArray(a))for(b=0;b<a.length;b++)d.registerMode(a[b]);else{if(!("mode"in a))throw new Error('Property "mode" missing');if(!("mixin"in a))throw new Error('Property "mixin" missing');if(!("data"in a))throw new Error('Property "data" missing');var f=a.mode;if(f in d.modes)throw new Error('Mode "'+f+'" already registered');if("function"!=typeof a.mixin.create)throw new Error('Required function "create" missing on mixin');var g=["setMode","registerMode","modes"];for(b=0;b<g.length;b++)if(e=g[b],e in a.mixin)throw new Error('Reserved property "'+e+'" not allowed in mixin');d.modes[f]=a}},d.registerMode(a),d.registerMode(b),d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(4),c(5),c(6),c(7),c(8),c(3)],e=function(a,b,c,d,e,f){var g={};g.create=function(c,d){if(!c)throw new Error("No container element provided.");this.container=c,this.dom={},this.highlighter=new a,this.selection=void 0,this._setOptions(d),this.options.history&&!this.mode.view&&(this.history=new b(this)),this._createFrame(),this._createTable()},g._delete=function(){this.frame&&this.container&&this.frame.parentNode==this.container&&this.container.removeChild(this.frame)},g._setOptions=function(a){if(this.options={search:!0,history:!0,mode:"tree",name:void 0},a)for(var b in a)a.hasOwnProperty(b)&&(this.options[b]=a[b]);this.mode={edit:"view"!=this.options.mode&&"form"!=this.options.mode,view:"view"==this.options.mode,form:"form"==this.options.mode}};var h=void 0,i=null;return g.set=function(a,b){if(b&&(f.log('Warning: second parameter "name" is deprecated. Use setName(name) instead.'),this.options.name=b),a instanceof Function||void 0===a)this.clear();else{this.content.removeChild(this.table);var c={field:this.options.name,value:a},e=new d(this,c);this._setRoot(e);var g=!1;this.node.expand(g),this.content.appendChild(this.table)}this.history&&this.history.clear()},g.get=function(){return h&&h.blur(),this.node?this.node.getValue():void 0},g.getText=function(){return JSON.stringify(this.get())},g.setText=function(a){this.set(f.parse(a))},g.setName=function(a){this.options.name=a,this.node&&this.node.updateField(this.options.name)},g.getName=function(){return this.options.name},g.clear=function(){this.node&&(this.node.collapse(),this.tbody.removeChild(this.node.getDom()),delete this.node)},g._setRoot=function(a){this.clear(),this.node=a,this.tbody.appendChild(a.getDom())},g.search=function(a){var b;return this.node?(this.content.removeChild(this.table),b=this.node.search(a),this.content.appendChild(this.table)):b=[],b},g.expandAll=function(){this.node&&(this.content.removeChild(this.table),this.node.expand(),this.content.appendChild(this.table))},g.collapseAll=function(){this.node&&(this.content.removeChild(this.table),this.node.collapse(),this.content.appendChild(this.table))},g._onAction=function(a,b){if(this.history&&this.history.add(a,b),this.options.change)try{this.options.change()}catch(c){f.log("Error in change callback: ",c)}},g.startAutoScroll=function(a){var b=this,c=this.content,d=f.getAbsoluteTop(c),e=c.clientHeight,g=d+e,h=24,i=50;this.autoScrollStep=d+h>a&&c.scrollTop>0?(d+h-a)/3:a>g-h&&e+c.scrollTop<c.scrollHeight?(g-h-a)/3:void 0,this.autoScrollStep?this.autoScrollTimer||(this.autoScrollTimer=setInterval(function(){b.autoScrollStep?c.scrollTop-=b.autoScrollStep:b.stopAutoScroll()},i)):this.stopAutoScroll()},g.stopAutoScroll=function(){this.autoScrollTimer&&(clearTimeout(this.autoScrollTimer),delete this.autoScrollTimer),this.autoScrollStep&&delete this.autoScrollStep},g.setSelection=function(a){a&&("scrollTop"in a&&this.content&&(this.content.scrollTop=a.scrollTop),a.range&&f.setSelectionOffset(a.range),a.dom&&a.dom.focus())},g.getSelection=function(){return{dom:i,scrollTop:this.content?this.content.scrollTop:0,range:f.getSelectionOffset()}},g.scrollTo=function(a,b){var c=this.content;if(c){var d=this;d.animateTimeout&&(clearTimeout(d.animateTimeout),delete d.animateTimeout),d.animateCallback&&(d.animateCallback(!1),delete d.animateCallback);var e=c.clientHeight,f=c.scrollHeight-e,g=Math.min(Math.max(a-e/4,0),f),h=function(){var a=c.scrollTop,e=g-a;Math.abs(e)>3?(c.scrollTop+=e/3,d.animateCallback=b,d.animateTimeout=setTimeout(h,50)):(b&&b(!0),c.scrollTop=g,delete d.animateTimeout,delete d.animateCallback)};h()}else b&&b(!1)},g._createFrame=function(){function a(a){b._onEvent(a)}this.frame=document.createElement("div"),this.frame.className="jsoneditor",this.container.appendChild(this.frame);var b=this;this.frame.onclick=function(b){var c=b.target;a(b),"BUTTON"==c.nodeName&&b.preventDefault()},this.frame.oninput=a,this.frame.onchange=a,this.frame.onkeydown=a,this.frame.onkeyup=a,this.frame.oncut=a,this.frame.onpaste=a,this.frame.onmousedown=a,this.frame.onmouseup=a,this.frame.onmouseover=a,this.frame.onmouseout=a,f.addEventListener(this.frame,"focus",a,!0),f.addEventListener(this.frame,"blur",a,!0),this.frame.onfocusin=a,this.frame.onfocusout=a,this.menu=document.createElement("div"),this.menu.className="menu",this.frame.appendChild(this.menu);var d=document.createElement("button");d.className="expand-all",d.title="Expand all fields",d.onclick=function(){b.expandAll()},this.menu.appendChild(d);var g=document.createElement("button");if(g.title="Collapse all fields",g.className="collapse-all",g.onclick=function(){b.collapseAll()},this.menu.appendChild(g),this.history){var h=document.createElement("button");h.className="undo separator",h.title="Undo last action (Ctrl+Z)",h.onclick=function(){b._onUndo()},this.menu.appendChild(h),this.dom.undo=h;var i=document.createElement("button");i.className="redo",i.title="Redo (Ctrl+Shift+Z)",i.onclick=function(){b._onRedo()},this.menu.appendChild(i),this.dom.redo=i,this.history.onChange=function(){h.disabled=!b.history.canUndo(),i.disabled=!b.history.canRedo()},this.history.onChange()}if(this.options&&this.options.modes&&this.options.modes.length){var j=e.create(this,this.options.modes,this.options.mode);this.menu.appendChild(j),this.dom.modeBox=j}this.options.search&&(this.searchBox=new c(this,this.menu))},g._onUndo=function(){this.history&&(this.history.undo(),this.options.change&&this.options.change())},g._onRedo=function(){this.history&&(this.history.redo(),this.options.change&&this.options.change())},g._onEvent=function(a){var b=a.target;"keydown"==a.type&&this._onKeyDown(a),"focus"==a.type&&(i=b);var c=d.getNodeFromTarget(b);c&&c.onEvent(a)},g._onKeyDown=function(a){var b=a.which||a.keyCode,c=a.ctrlKey,d=a.shiftKey,e=!1;if(9==b&&setTimeout(function(){f.selectContentEditable(i)},0),this.searchBox)if(c&&70==b)this.searchBox.dom.search.focus(),this.searchBox.dom.search.select(),e=!0;else if(114==b||c&&71==b){var g=!0;d?this.searchBox.previous(g):this.searchBox.next(g),e=!0}this.history&&(c&&!d&&90==b?(this._onUndo(),e=!0):c&&d&&90==b&&(this._onRedo(),e=!0)),e&&(a.preventDefault(),a.stopPropagation())},g._createTable=function(){var a=document.createElement("div");a.className="outer",this.contentOuter=a,this.content=document.createElement("div"),this.content.className="tree",a.appendChild(this.content),this.table=document.createElement("table"),this.table.className="tree",this.content.appendChild(this.table);var b;this.colgroupContent=document.createElement("colgroup"),this.mode.edit&&(b=document.createElement("col"),b.width="24px",this.colgroupContent.appendChild(b)),b=document.createElement("col"),b.width="24px",this.colgroupContent.appendChild(b),b=document.createElement("col"),this.colgroupContent.appendChild(b),this.table.appendChild(this.colgroupContent),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.frame.appendChild(a)},[{mode:"tree",mixin:g,data:"json"},{mode:"view",mixin:g,data:"json"},{mode:"form",mixin:g,data:"json"}]}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(8),c(3)],e=function(a,b){var c={};return c.create=function(c,d){d=d||{},this.options=d,this.indentation=d.indentation?Number(d.indentation):2,this.mode="code"==d.mode?"code":"text","code"==this.mode&&"undefined"==typeof ace&&(this.mode="text",b.log("WARNING: Cannot load code editor, Ace library not loaded. Falling back to plain text editor"));var e=this;this.container=c,this.dom={},this.editor=void 0,this.textarea=void 0,this.width=c.clientWidth,this.height=c.clientHeight,this.frame=document.createElement("div"),this.frame.className="jsoneditor",this.frame.onclick=function(a){a.preventDefault()},this.menu=document.createElement("div"),this.menu.className="menu",this.frame.appendChild(this.menu);var f=document.createElement("button");f.className="format",f.title="Format JSON data, with proper indentation and line feeds",this.menu.appendChild(f),f.onclick=function(){try{e.format()}catch(a){e._onError(a)}};var g=document.createElement("button");if(g.className="compact",g.title="Compact JSON data, remove all whitespaces",this.menu.appendChild(g),g.onclick=function(){try{e.compact()}catch(a){e._onError(a)}},this.options&&this.options.modes&&this.options.modes.length){var h=a.create(this,this.options.modes,this.options.mode);this.menu.appendChild(h),this.dom.modeBox=h}if(this.content=document.createElement("div"),this.content.className="outer",this.frame.appendChild(this.content),this.container.appendChild(this.frame),"code"==this.mode){this.editorDom=document.createElement("div"),this.editorDom.style.height="100%",this.editorDom.style.width="100%",this.content.appendChild(this.editorDom);var i=ace.edit(this.editorDom);i.setTheme("ace/theme/jsoneditor"),i.setShowPrintMargin(!1),i.setFontSize(13),i.getSession().setMode("ace/mode/json"),i.getSession().setTabSize(2),i.getSession().setUseSoftTabs(!0),i.getSession().setUseWrapMode(!0),this.editor=i;var j=document.createElement("a");j.appendChild(document.createTextNode("powered by ace")),j.href="http://ace.ajax.org",j.target="_blank",j.className="poweredBy",j.onclick=function(){window.open(j.href,j.target)},this.menu.appendChild(j),d.change&&i.on("change",function(){d.change()})}else{var k=document.createElement("textarea");k.className="text",k.spellcheck=!1,this.content.appendChild(k),this.textarea=k,d.change&&(null===this.textarea.oninput?this.textarea.oninput=function(){d.change()}:this.textarea.onchange=function(){d.change()})}},c._delete=function(){this.frame&&this.container&&this.frame.parentNode==this.container&&this.container.removeChild(this.frame)},c._onError=function(a){if("function"==typeof this.onError&&(b.log("WARNING: JSONEditor.onError is deprecated. Use options.error instead."),this.onError(a)),!this.options||"function"!=typeof this.options.error)throw a;this.options.error(a)},c.compact=function(){var a=b.parse(this.getText());this.setText(JSON.stringify(a))},c.format=function(){var a=b.parse(this.getText());this.setText(JSON.stringify(a,null,this.indentation))},c.focus=function(){this.textarea&&this.textarea.focus(),this.editor&&this.editor.focus()},c.resize=function(){if(this.editor){var a=!1;this.editor.resize(a)}},c.set=function(a){this.setText(JSON.stringify(a,null,this.indentation))},c.get=function(){return b.parse(this.getText())},c.getText=function(){return this.textarea?this.textarea.value:this.editor?this.editor.getValue():""},c.setText=function(a){this.textarea&&(this.textarea.value=a),this.editor&&this.editor.setValue(a,-1)},[{mode:"text",mixin:c,data:"text",load:c.format},{mode:"code",mixin:c,data:"text",load:c.format}]}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d;d=function(){var a={};a.parse=function(b){try{return JSON.parse(b)}catch(c){throw a.validate(b),c}},a.validate=function(a){"undefined"!=typeof jsonlint?jsonlint.parse(a):JSON.parse(a)},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.clear=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b];return a},a.log=function(){"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)},a.type=function(b){return null===b?"null":void 0===b?"undefined":b instanceof Number||"number"==typeof b?"number":b instanceof String||"string"==typeof b?"string":b instanceof Boolean||"boolean"==typeof b?"boolean":b instanceof RegExp||"regexp"==typeof b?"regexp":a.isArray(b)?"array":"object"};var b=/^https?:\/\/\S+$/;a.isUrl=function(a){return("string"==typeof a||a instanceof String)&&b.test(a)},a.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.getAbsoluteLeft=function(a){var b=a.getBoundingClientRect();return b.left+window.pageXOffset||document.scrollLeft||0},a.getAbsoluteTop=function(a){var b=a.getBoundingClientRect();return b.top+window.pageYOffset||document.scrollTop||0},a.addClassName=function(a,b){var c=a.className.split(" ");-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" "))},a.removeClassName=function(a,b){var c=a.className.split(" "),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.className=c.join(" "))},a.stripFormatting=function(b){for(var c=b.childNodes,d=0,e=c.length;e>d;d++){var f=c[d];f.style&&f.removeAttribute("style");var g=f.attributes;if(g)for(var h=g.length-1;h>=0;h--){var i=g[h];1==i.specified&&f.removeAttribute(i.name)}a.stripFormatting(f)}},a.setEndOfContentEditable=function(a){var b,c;document.createRange&&(b=document.createRange(),b.selectNodeContents(a),b.collapse(!1),c=window.getSelection(),c.removeAllRanges(),c.addRange(b))},a.selectContentEditable=function(a){if(a&&"DIV"==a.nodeName){var b,c;window.getSelection&&document.createRange&&(c=document.createRange(),c.selectNodeContents(a),b=window.getSelection(),b.removeAllRanges(),b.addRange(c))}},a.getSelection=function(){if(window.getSelection){var a=window.getSelection();if(a.getRangeAt&&a.rangeCount)return a.getRangeAt(0)}return null},a.setSelection=function(a){if(a&&window.getSelection){var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}},a.getSelectionOffset=function(){var b=a.getSelection();return b&&"startOffset"in b&&"endOffset"in b&&b.startContainer&&b.startContainer==b.endContainer?{startOffset:b.startOffset,endOffset:b.endOffset,container:b.startContainer.parentNode}:null},a.setSelectionOffset=function(b){if(document.createRange&&window.getSelection){var c=window.getSelection();if(c){var d=document.createRange();d.setStart(b.container.firstChild,b.startOffset),d.setEnd(b.container.firstChild,b.endOffset),a.setSelection(d)}}},a.getInnerText=function(b,c){var d=void 0==c;if(d&&(c={text:"",flush:function(){var a=this.text;return this.text="",a},set:function(a){this.text=a}}),b.nodeValue)return c.flush()+b.nodeValue;if(b.hasChildNodes()){for(var e=b.childNodes,f="",g=0,h=e.length;h>g;g++){var i=e[g];if("DIV"==i.nodeName||"P"==i.nodeName){var j=e[g-1],k=j?j.nodeName:void 0;k&&"DIV"!=k&&"P"!=k&&"BR"!=k&&(f+="\n",c.flush()),f+=a.getInnerText(i,c),c.set("\n")}else"BR"==i.nodeName?(f+=c.flush(),c.set("\n")):f+=a.getInnerText(i,c)}return f}return"P"==b.nodeName&&-1!=a.getInternetExplorerVersion()?c.flush():""},a.getInternetExplorerVersion=function(){if(-1==c){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,d=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=d.exec(b)&&(a=parseFloat(RegExp.$1))}c=a}return c},a.isFirefox=function(){return-1!=navigator.userAgent.indexOf("Firefox")};var c=-1;return a.addEventListener=function(b,c,d,e){if(b.addEventListener)return void 0===e&&(e=!1),"mousewheel"===c&&a.isFirefox()&&(c="DOMMouseScroll"),b.addEventListener(c,d,e),d;if(b.attachEvent){var f=function(){return d.call(b,window.event)};return b.attachEvent("on"+c,f),f}},a.removeEventListener=function(b,c,d,e){b.removeEventListener?(void 0===e&&(e=!1),"mousewheel"===c&&a.isFirefox()&&(c="DOMMouseScroll"),b.removeEventListener(c,d,e)):b.detachEvent&&b.detachEvent("on"+c,d)},a}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(){function a(){this.locked=!1}return a.prototype.highlight=function(a){this.locked||(this.node!=a&&(this.node&&this.node.setHighlight(!1),this.node=a,this.node.setHighlight(!0)),this._cancelUnhighlight())},a.prototype.unhighlight=function(){if(!this.locked){var a=this;this.node&&(this._cancelUnhighlight(),this.unhighlightTimer=setTimeout(function(){a.node.setHighlight(!1),a.node=void 0,a.unhighlightTimer=void 0},0))}},a.prototype._cancelUnhighlight=function(){this.unhighlightTimer&&(clearTimeout(this.unhighlightTimer),this.unhighlightTimer=void 0)},a.prototype.lock=function(){this.locked=!0},a.prototype.unlock=function(){this.locked=!1},a}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d,e;d=[c(3)],e=function(a){function b(a){this.editor=a,this.clear(),this.actions={editField:{undo:function(a){a.node.updateField(a.oldValue)},redo:function(a){a.node.updateField(a.newValue)}},editValue:{undo:function(a){a.node.updateValue(a.oldValue)},redo:function(a){a.node.updateValue(a.newValue)}},appendNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.appendChild(a.node)}},insertBeforeNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.insertBefore(a.node,a.beforeNode)}},insertAfterNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.insertAfter(a.node,a.afterNode)}},removeNode:{undo:function(a){var b=a.parent,c=b.childs[a.index]||b.append;b.insertBefore(a.node,c)},redo:function(a){a.parent.removeChild(a.node)}},duplicateNode:{undo:function(a){a.parent.removeChild(a.clone)},redo:function(a){a.parent.insertAfter(a.clone,a.node)}},changeType:{undo:function(a){a.node.changeType(a.oldType)},redo:function(a){a.node.changeType(a.newType)}},moveNode:{undo:function(a){a.startParent.moveTo(a.node,a.startIndex)},redo:function(a){a.endParent.moveTo(a.node,a.endIndex)}},sort:{undo:function(a){var b=a.node;b.hideChilds(),b.sort=a.oldSort,b.childs=a.oldChilds,b.showChilds()},redo:function(a){var b=a.node;b.hideChilds(),b.sort=a.newSort,b.childs=a.newChilds,b.showChilds()}}}}return b.prototype.onChange=function(){},b.prototype.add=function(a,b){this.index++,this.history[this.index]={action:a,params:b,timestamp:new Date},this.index<this.history.length-1&&this.history.splice(this.index+1,this.history.length-this.index-1),this.onChange()},b.prototype.clear=function(){this.history=[],this.index=-1,this.onChange()},b.prototype.canUndo=function(){return this.index>=0},b.prototype.canRedo=function(){return this.index<this.history.length-1},b.prototype.undo=function(){if(this.canUndo()){var b=this.history[this.index];if(b){var c=this.actions[b.action];c&&c.undo?(c.undo(b.params),b.params.oldSelection&&this.editor.setSelection(b.params.oldSelection)):a.log('Error: unknown action "'+b.action+'"')}this.index--,this.onChange()}},b.prototype.redo=function(){if(this.canRedo()){this.index++;var b=this.history[this.index];if(b){var c=this.actions[b.action];c&&c.redo?(c.redo(b.params),b.params.newSelection&&this.editor.setSelection(b.params.newSelection)):a.log('Error: unknown action "'+b.action+'"')}this.onChange()}},b}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d;d=function(){function a(a,b){var c=this;this.editor=a,this.timeout=void 0,this.delay=200,this.lastText=void 0,this.dom={},this.dom.container=b;var d=document.createElement("table");this.dom.table=d,d.className="search",b.appendChild(d);var e=document.createElement("tbody");this.dom.tbody=e,d.appendChild(e);var f=document.createElement("tr");e.appendChild(f);var g=document.createElement("td");f.appendChild(g);var h=document.createElement("div");this.dom.results=h,h.className="results",g.appendChild(h),g=document.createElement("td"),f.appendChild(g);var i=document.createElement("div");this.dom.input=i,i.className="frame",i.title="Search fields and values",g.appendChild(i);var j=document.createElement("table");i.appendChild(j);var k=document.createElement("tbody");j.appendChild(k),f=document.createElement("tr"),k.appendChild(f);var l=document.createElement("button");l.className="refresh",g=document.createElement("td"),g.appendChild(l),f.appendChild(g);var m=document.createElement("input");this.dom.search=m,m.oninput=function(a){c._onDelayedSearch(a)},m.onchange=function(a){c._onSearch(a)},m.onkeydown=function(a){c._onKeyDown(a)},m.onkeyup=function(a){c._onKeyUp(a)},l.onclick=function(){m.select()},g=document.createElement("td"),g.appendChild(m),f.appendChild(g);var n=document.createElement("button");n.title="Next result (Enter)",n.className="next",n.onclick=function(){c.next()},g=document.createElement("td"),g.appendChild(n),f.appendChild(g);var o=document.createElement("button");o.title="Previous result (Shift+Enter)",o.className="previous",o.onclick=function(){c.previous()},g=document.createElement("td"),g.appendChild(o),f.appendChild(g)}return a.prototype.next=function(a){if(void 0!=this.results){var b=void 0!=this.resultIndex?this.resultIndex+1:0;b>this.results.length-1&&(b=0),this._setActiveResult(b,a)}},a.prototype.previous=function(a){if(void 0!=this.results){var b=this.results.length-1,c=void 0!=this.resultIndex?this.resultIndex-1:b;0>c&&(c=b),this._setActiveResult(c,a)}},a.prototype._setActiveResult=function(a,b){if(this.activeResult){var c=this.activeResult.node,d=this.activeResult.elem;"field"==d?delete c.searchFieldActive:delete c.searchValueActive,c.updateDom()}if(!this.results||!this.results[a])return this.resultIndex=void 0,void(this.activeResult=void 0);this.resultIndex=a;var e=this.results[this.resultIndex].node,f=this.results[this.resultIndex].elem;"field"==f?e.searchFieldActive=!0:e.searchValueActive=!0,this.activeResult=this.results[this.resultIndex],e.updateDom(),e.scrollTo(function(){b&&e.focus(f)})},a.prototype._clearDelay=function(){void 0!=this.timeout&&(clearTimeout(this.timeout),delete this.timeout)},a.prototype._onDelayedSearch=function(){this._clearDelay();var a=this;this.timeout=setTimeout(function(b){a._onSearch(b)},this.delay)},a.prototype._onSearch=function(a,b){this._clearDelay();var c=this.dom.search.value,d=c.length>0?c:void 0;if(d!=this.lastText||b)if(this.lastText=d,this.results=this.editor.search(d),this._setActiveResult(void 0),void 0!=d){var e=this.results.length;switch(e){case 0:this.dom.results.innerHTML="no&nbsp;results";break;case 1:this.dom.results.innerHTML="1&nbsp;result";break;default:this.dom.results.innerHTML=e+"&nbsp;results"}}else this.dom.results.innerHTML=""},a.prototype._onKeyDown=function(a){var b=a.which;27==b?(this.dom.search.value="",this._onSearch(a),a.preventDefault(),a.stopPropagation()):13==b&&(a.ctrlKey?this._onSearch(a,!0):a.shiftKey?this.previous():this.next(),a.preventDefault(),a.stopPropagation())},a.prototype._onKeyUp=function(a){var b=a.keyCode;27!=b&&13!=b&&this._onDelayedSearch(a)},a}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d,e;d=[c(9),c(10),c(3)],e=function(a,b,c){function d(a,b){this.editor=a,this.dom={},this.expanded=!1,b&&b instanceof Object?(this.setField(b.field,b.fieldEditable),this.setValue(b.value,b.type)):(this.setField(""),this.setValue(null))}d.prototype.setParent=function(a){this.parent=a},d.prototype.setField=function(a,b){this.field=a,this.fieldEditable=1==b},d.prototype.getField=function(){return void 0===this.field&&this._getDomField(),this.field},d.prototype.setValue=function(a,b){var c,e,f=this.childs;if(f)for(;f.length;)this.removeChild(f[0]);if(this.type=this._getType(a),b&&b!=this.type){if("string"!=b||"auto"!=this.type)throw new Error('Type mismatch: cannot cast value of type "'+this.type+' to the specified type "'+b+'"');this.type=b}if("array"==this.type){this.childs=[];for(var g=0,h=a.length;h>g;g++)c=a[g],void 0===c||c instanceof Function||(e=new d(this.editor,{value:c}),this.appendChild(e));this.value=""}else if("object"==this.type){this.childs=[];for(var i in a)a.hasOwnProperty(i)&&(c=a[i],void 0===c||c instanceof Function||(e=new d(this.editor,{field:i,value:c}),this.appendChild(e)));this.value=""}else this.childs=void 0,this.value=a},d.prototype.getValue=function(){if("array"==this.type){var a=[];return this.childs.forEach(function(b){a.push(b.getValue())}),a}if("object"==this.type){var b={};return this.childs.forEach(function(a){b[a.getField()]=a.getValue()}),b}return void 0===this.value&&this._getDomValue(),this.value},d.prototype.getLevel=function(){return this.parent?this.parent.getLevel()+1:0},d.prototype.clone=function(){var a=new d(this.editor);if(a.type=this.type,a.field=this.field,a.fieldInnerText=this.fieldInnerText,a.fieldEditable=this.fieldEditable,a.value=this.value,a.valueInnerText=this.valueInnerText,a.expanded=this.expanded,this.childs){var b=[];this.childs.forEach(function(c){var d=c.clone();d.setParent(a),b.push(d)}),a.childs=b}else a.childs=void 0;return a},d.prototype.expand=function(a){this.childs&&(this.expanded=!0,this.dom.expand&&(this.dom.expand.className="expanded"),this.showChilds(),0!=a&&this.childs.forEach(function(b){b.expand(a)}))},d.prototype.collapse=function(a){this.childs&&(this.hideChilds(),0!=a&&this.childs.forEach(function(b){b.collapse(a)}),this.dom.expand&&(this.dom.expand.className="collapsed"),this.expanded=!1)},d.prototype.showChilds=function(){var a=this.childs;if(a&&this.expanded){var b=this.dom.tr,c=b?b.parentNode:void 0;if(c){var d=this.getAppend(),e=b.nextSibling;e?c.insertBefore(d,e):c.appendChild(d),this.childs.forEach(function(a){c.insertBefore(a.getDom(),d),a.showChilds()})}}},d.prototype.hide=function(){var a=this.dom.tr,b=a?a.parentNode:void 0;b&&b.removeChild(a),this.hideChilds()},d.prototype.hideChilds=function(){var a=this.childs;if(a&&this.expanded){var b=this.getAppend();b.parentNode&&b.parentNode.removeChild(b),this.childs.forEach(function(a){a.hide()})}},d.prototype.appendChild=function(a){if(this._hasChilds()){if(a.setParent(this),a.fieldEditable="object"==this.type,"array"==this.type&&(a.index=this.childs.length),this.childs.push(a),this.expanded){var b=a.getDom(),c=this.getAppend(),d=c?c.parentNode:void 0;c&&d&&d.insertBefore(b,c),a.showChilds()}this.updateDom({updateIndexes:!0}),a.updateDom({recurse:!0})}},d.prototype.moveBefore=function(a,b){if(this._hasChilds()){var c=this.dom.tr?this.dom.tr.parentNode:void 0;if(c){var d=document.createElement("tr");d.style.height=c.clientHeight+"px",c.appendChild(d)}a.parent&&a.parent.removeChild(a),b instanceof e?this.appendChild(a):this.insertBefore(a,b),c&&c.removeChild(d)}},d.prototype.moveTo=function(a,b){if(a.parent==this){var c=this.childs.indexOf(a);b>c&&b++}var d=this.childs[b]||this.append;this.moveBefore(a,d)},d.prototype.insertBefore=function(a,b){if(this._hasChilds()){if(b==this.append)a.setParent(this),a.fieldEditable="object"==this.type,this.childs.push(a);else{var c=this.childs.indexOf(b);if(-1==c)throw new Error("Node not found");a.setParent(this),a.fieldEditable="object"==this.type,this.childs.splice(c,0,a)}if(this.expanded){var d=a.getDom(),e=b.getDom(),f=e?e.parentNode:void 0;e&&f&&f.insertBefore(d,e),a.showChilds()}this.updateDom({updateIndexes:!0}),a.updateDom({recurse:!0})}},d.prototype.insertAfter=function(a,b){if(this._hasChilds()){var c=this.childs.indexOf(b),d=this.childs[c+1];d?this.insertBefore(a,d):this.appendChild(a)}},d.prototype.search=function(a){var b,c=[],d=a?a.toLowerCase():void 0;if(delete this.searchField,delete this.searchValue,void 0!=this.field){var e=String(this.field).toLowerCase();b=e.indexOf(d),-1!=b&&(this.searchField=!0,c.push({node:this,elem:"field"})),this._updateDomField()}if(this._hasChilds()){if(this.childs){var f=[];this.childs.forEach(function(b){f=f.concat(b.search(a))}),c=c.concat(f)}if(void 0!=d){var g=!1;0==f.length?this.collapse(g):this.expand(g)}}else{if(void 0!=this.value){var h=String(this.value).toLowerCase();b=h.indexOf(d),-1!=b&&(this.searchValue=!0,c.push({node:this,elem:"value"}))}this._updateDomValue()}return c},d.prototype.scrollTo=function(a){if(!this.dom.tr||!this.dom.tr.parentNode)for(var b=this.parent,c=!1;b;)b.expand(c),b=b.parent;this.dom.tr&&this.dom.tr.parentNode&&this.editor.scrollTo(this.dom.tr.offsetTop,a)},d.focusElement=void 0,d.prototype.focus=function(a){if(d.focusElement=a,this.dom.tr&&this.dom.tr.parentNode){var b=this.dom;switch(a){case"drag":b.drag?b.drag.focus():b.menu.focus();break;case"menu":b.menu.focus();break;case"expand":this._hasChilds()?b.expand.focus():b.field&&this.fieldEditable?(b.field.focus(),c.selectContentEditable(b.field)):b.value&&!this._hasChilds()?(b.value.focus(),c.selectContentEditable(b.value)):b.menu.focus();break;case"field":b.field&&this.fieldEditable?(b.field.focus(),c.selectContentEditable(b.field)):b.value&&!this._hasChilds()?(b.value.focus(),c.selectContentEditable(b.value)):this._hasChilds()?b.expand.focus():b.menu.focus();break;case"value":default:b.value&&!this._hasChilds()?(b.value.focus(),c.selectContentEditable(b.value)):b.field&&this.fieldEditable?(b.field.focus(),c.selectContentEditable(b.field)):this._hasChilds()?b.expand.focus():b.menu.focus()}}},d.select=function(a){setTimeout(function(){c.selectContentEditable(a)},0)},d.prototype.blur=function(){this._getDomValue(!1),this._getDomField(!1)},d.prototype._duplicate=function(a){var b=a.clone();return this.insertAfter(b,a),b},d.prototype.containsNode=function(a){if(this==a)return!0;var b=this.childs;if(b)for(var c=0,d=b.length;d>c;c++)if(b[c].containsNode(a))return!0;return!1},d.prototype._move=function(a,b){if(a!=b){if(a.containsNode(this))throw new Error("Cannot move a field into a child of itself");a.parent&&a.parent.removeChild(a);var c=a.clone();a.clearDom(),b?this.insertBefore(c,b):this.appendChild(c)}},d.prototype.removeChild=function(a){if(this.childs){var b=this.childs.indexOf(a);if(-1!=b){a.hide(),delete a.searchField,delete a.searchValue;var c=this.childs.splice(b,1)[0];return this.updateDom({updateIndexes:!0}),c}}return void 0},d.prototype._remove=function(a){this.removeChild(a)},d.prototype.changeType=function(a){var b=this.type;if(b!=a){if("string"!=a&&"auto"!=a||"string"!=b&&"auto"!=b){var c,d=this.dom.tr?this.dom.tr.parentNode:void 0;c=this.expanded?this.getAppend():this.getDom();var e=c&&c.parentNode?c.nextSibling:void 0;this.hide(),this.clearDom(),this.type=a,"object"==a?(this.childs||(this.childs=[]),this.childs.forEach(function(a){a.clearDom(),delete a.index,a.fieldEditable=!0,void 0==a.field&&(a.field="")
}),("string"==b||"auto"==b)&&(this.expanded=!0)):"array"==a?(this.childs||(this.childs=[]),this.childs.forEach(function(a,b){a.clearDom(),a.fieldEditable=!1,a.index=b}),("string"==b||"auto"==b)&&(this.expanded=!0)):this.expanded=!1,d&&(e?d.insertBefore(this.getDom(),e):d.appendChild(this.getDom())),this.showChilds()}else this.type=a;("auto"==a||"string"==a)&&(this.value="string"==a?String(this.value):this._stringCast(String(this.value)),this.focus()),this.updateDom({updateIndexes:!0})}},d.prototype._getDomValue=function(a){if(this.dom.value&&"array"!=this.type&&"object"!=this.type&&(this.valueInnerText=c.getInnerText(this.dom.value)),void 0!=this.valueInnerText)try{var b;if("string"==this.type)b=this._unescapeHTML(this.valueInnerText);else{var d=this._unescapeHTML(this.valueInnerText);b=this._stringCast(d)}if(b!==this.value){var e=this.value;this.value=b,this.editor._onAction("editValue",{node:this,oldValue:e,newValue:b,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()})}}catch(f){if(this.value=void 0,1!=a)throw f}},d.prototype._updateDomValue=function(){var a=this.dom.value;if(a){var b=this.value,d="auto"==this.type?c.type(b):this.type,e="string"==d&&c.isUrl(b),f="";f=e&&!this.editor.mode.edit?"":"string"==d?"green":"number"==d?"red":"boolean"==d?"darkorange":this._hasChilds()?"":null===b?"#004ED0":"black",a.style.color=f;var g=""==String(this.value)&&"array"!=this.type&&"object"!=this.type;if(g?c.addClassName(a,"empty"):c.removeClassName(a,"empty"),e?c.addClassName(a,"url"):c.removeClassName(a,"url"),"array"==d||"object"==d){var h=this.childs?this.childs.length:0;a.title=this.type+" containing "+h+" items"}else"string"==d&&c.isUrl(b)?this.editor.mode.edit&&(a.title="Ctrl+Click or Ctrl+Enter to open url in new window"):a.title="";this.searchValueActive?c.addClassName(a,"highlight-active"):c.removeClassName(a,"highlight-active"),this.searchValue?c.addClassName(a,"highlight"):c.removeClassName(a,"highlight"),c.stripFormatting(a)}},d.prototype._updateDomField=function(){var a=this.dom.field;if(a){var b=""==String(this.field)&&"array"!=this.parent.type;b?c.addClassName(a,"empty"):c.removeClassName(a,"empty"),this.searchFieldActive?c.addClassName(a,"highlight-active"):c.removeClassName(a,"highlight-active"),this.searchField?c.addClassName(a,"highlight"):c.removeClassName(a,"highlight"),c.stripFormatting(a)}},d.prototype._getDomField=function(a){if(this.dom.field&&this.fieldEditable&&(this.fieldInnerText=c.getInnerText(this.dom.field)),void 0!=this.fieldInnerText)try{var b=this._unescapeHTML(this.fieldInnerText);if(b!==this.field){var d=this.field;this.field=b,this.editor._onAction("editField",{node:this,oldValue:d,newValue:b,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()})}}catch(e){if(this.field=void 0,1!=a)throw e}},d.prototype.clearDom=function(){this.dom={}},d.prototype.getDom=function(){var a=this.dom;if(a.tr)return a.tr;if(a.tr=document.createElement("tr"),a.tr.node=this,this.editor.mode.edit){var b=document.createElement("td");if(this.parent){var c=document.createElement("button");a.drag=c,c.className="dragarea",c.title="Drag to move this field (Alt+Shift+Arrows)",b.appendChild(c)}a.tr.appendChild(b);var d=document.createElement("td"),e=document.createElement("button");a.menu=e,e.className="contextmenu",e.title="Click to open the actions menu (Ctrl+M)",d.appendChild(a.menu),a.tr.appendChild(d)}var f=document.createElement("td");return a.tr.appendChild(f),a.tree=this._createDomTree(),f.appendChild(a.tree),this.updateDom({updateIndexes:!0}),a.tr},d.prototype._onDragStart=function(a){var b=this;this.mousemove||(this.mousemove=c.addEventListener(document,"mousemove",function(a){b._onDrag(a)})),this.mouseup||(this.mouseup=c.addEventListener(document,"mouseup",function(a){b._onDragEnd(a)})),this.editor.highlighter.lock(),this.drag={oldCursor:document.body.style.cursor,startParent:this.parent,startIndex:this.parent.childs.indexOf(this),mouseX:a.pageX,level:this.getLevel()},document.body.style.cursor="move",a.preventDefault()},d.prototype._onDrag=function(a){var b,f,g,h,i,j,k,l,m,n,o,p,q,r,s=a.pageY,t=a.pageX,u=!1;if(b=this.dom.tr,m=c.getAbsoluteTop(b),p=b.offsetHeight,m>s){f=b;do f=f.previousSibling,k=d.getNodeFromTarget(f),n=f?c.getAbsoluteTop(f):0;while(f&&n>s);k&&!k.parent&&(k=void 0),k||(j=b.parentNode.firstChild,f=j?j.nextSibling:void 0,k=d.getNodeFromTarget(f),k==this&&(k=void 0)),k&&(f=k.dom.tr,n=f?c.getAbsoluteTop(f):0,s>n+p&&(k=void 0)),k&&(k.parent.moveBefore(this,k),u=!0)}else if(i=this.expanded&&this.append?this.append.getDom():this.dom.tr,h=i?i.nextSibling:void 0){o=c.getAbsoluteTop(h),g=h;do l=d.getNodeFromTarget(g),g&&(q=g.nextSibling?c.getAbsoluteTop(g.nextSibling):0,r=g?q-o:0,1==l.parent.childs.length&&l.parent.childs[0]==this&&(m+=23)),g=g.nextSibling;while(g&&s>m+r);if(l&&l.parent){var v=t-this.drag.mouseX,w=Math.round(v/24/2),x=this.drag.level+w,y=l.getLevel();for(f=l.dom.tr.previousSibling;x>y&&f;){if(k=d.getNodeFromTarget(f),k==this||k._isChildOf(this));else{if(!(k instanceof e))break;var z=k.parent.childs;if(!(z.length>1||1==z.length&&z[0]!=this))break;l=d.getNodeFromTarget(f),y=l.getLevel()}f=f.previousSibling}i.nextSibling!=l.dom.tr&&(l.parent.moveBefore(this,l),u=!0)}}u&&(this.drag.mouseX=t,this.drag.level=this.getLevel()),this.editor.startAutoScroll(s),a.preventDefault()},d.prototype._onDragEnd=function(a){var b={node:this,startParent:this.drag.startParent,startIndex:this.drag.startIndex,endParent:this.parent,endIndex:this.parent.childs.indexOf(this)};(b.startParent!=b.endParent||b.startIndex!=b.endIndex)&&this.editor._onAction("moveNode",b),document.body.style.cursor=this.drag.oldCursor,this.editor.highlighter.unlock(),delete this.drag,this.mousemove&&(c.removeEventListener(document,"mousemove",this.mousemove),delete this.mousemove),this.mouseup&&(c.removeEventListener(document,"mouseup",this.mouseup),delete this.mouseup),this.editor.stopAutoScroll(),a.preventDefault()},d.prototype._isChildOf=function(a){for(var b=this.parent;b;){if(b==a)return!0;b=b.parent}return!1},d.prototype._createDomField=function(){return document.createElement("div")},d.prototype.setHighlight=function(a){this.dom.tr&&(this.dom.tr.className=a?"highlight":"",this.append&&this.append.setHighlight(a),this.childs&&this.childs.forEach(function(b){b.setHighlight(a)}))},d.prototype.updateValue=function(a){this.value=a,this.updateDom()},d.prototype.updateField=function(a){this.field=a,this.updateDom()},d.prototype.updateDom=function(a){var b=this.dom.tree;b&&(b.style.marginLeft=24*this.getLevel()+"px");var c=this.dom.field;if(c){1==this.fieldEditable?(c.contentEditable=this.editor.mode.edit,c.spellcheck=!1,c.className="field"):c.className="readonly";var d;d=void 0!=this.index?this.index:void 0!=this.field?this.field:this._hasChilds()?this.type:"",c.innerHTML=this._escapeHTML(d)}var e=this.dom.value;if(e){var f=this.childs?this.childs.length:0;e.innerHTML="array"==this.type?"["+f+"]":"object"==this.type?"{"+f+"}":this._escapeHTML(this.value)}this._updateDomField(),this._updateDomValue(),a&&1==a.updateIndexes&&this._updateDomIndexes(),a&&1==a.recurse&&this.childs&&this.childs.forEach(function(b){b.updateDom(a)}),this.append&&this.append.updateDom()},d.prototype._updateDomIndexes=function(){var a=this.dom.value,b=this.childs;a&&b&&("array"==this.type?b.forEach(function(a,b){a.index=b;var c=a.dom.field;c&&(c.innerHTML=b)}):"object"==this.type&&b.forEach(function(a){void 0!=a.index&&(delete a.index,void 0==a.field&&(a.field=""))}))},d.prototype._createDomValue=function(){var a;return"array"==this.type?(a=document.createElement("div"),a.className="readonly",a.innerHTML="[...]"):"object"==this.type?(a=document.createElement("div"),a.className="readonly",a.innerHTML="{...}"):!this.editor.mode.edit&&c.isUrl(this.value)?(a=document.createElement("a"),a.className="value",a.href=this.value,a.target="_blank",a.innerHTML=this._escapeHTML(this.value)):(a=document.createElement("div"),a.contentEditable=!this.editor.mode.view,a.spellcheck=!1,a.className="value",a.innerHTML=this._escapeHTML(this.value)),a},d.prototype._createDomExpandButton=function(){var a=document.createElement("button");return this._hasChilds()?(a.className=this.expanded?"expanded":"collapsed",a.title="Click to expand/collapse this field (Ctrl+E). \nCtrl+Click to expand/collapse including all childs."):(a.className="invisible",a.title=""),a},d.prototype._createDomTree=function(){var a=this.dom,b=document.createElement("table"),c=document.createElement("tbody");b.style.borderCollapse="collapse",b.className="values",b.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var e=document.createElement("td");e.className="tree",d.appendChild(e),a.expand=this._createDomExpandButton(),e.appendChild(a.expand),a.tdExpand=e;var f=document.createElement("td");f.className="tree",d.appendChild(f),a.field=this._createDomField(),f.appendChild(a.field),a.tdField=f;var g=document.createElement("td");g.className="tree",d.appendChild(g),"object"!=this.type&&"array"!=this.type&&(g.appendChild(document.createTextNode(":")),g.className="separator"),a.tdSeparator=g;var h=document.createElement("td");return h.className="tree",d.appendChild(h),a.value=this._createDomValue(),h.appendChild(a.value),a.tdValue=h,b},d.prototype.onEvent=function(a){var b,d=a.type,e=a.target||a.srcElement,f=this.dom,g=this,h=this._hasChilds();if((e==f.drag||e==f.menu)&&("mouseover"==d?this.editor.highlighter.highlight(this):"mouseout"==d&&this.editor.highlighter.unhighlight()),"mousedown"==d&&e==f.drag&&this._onDragStart(a),"click"==d&&e==f.menu){var i=g.editor.highlighter;i.highlight(g),i.lock(),c.addClassName(f.menu,"selected"),this.showContextMenu(f.menu,function(){c.removeClassName(f.menu,"selected"),i.unlock(),i.unhighlight()})}if("click"==d&&e==f.expand&&h){var j=a.ctrlKey;this._onExpand(j)}var k=f.value;if(e==k)switch(d){case"focus":b=this;break;case"blur":case"change":this._getDomValue(!0),this._updateDomValue(),this.value&&(k.innerHTML=this._escapeHTML(this.value));break;case"input":this._getDomValue(!0),this._updateDomValue();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"click":a.ctrlKey&&this.editor.mode.edit&&c.isUrl(this.value)&&window.open(this.value,"_blank");break;case"keyup":this._getDomValue(!0),this._updateDomValue();break;case"cut":case"paste":setTimeout(function(){g._getDomValue(!0),g._updateDomValue()},1)}var l=f.field;if(e==l)switch(d){case"focus":b=this;break;case"blur":case"change":this._getDomField(!0),this._updateDomField(),this.field&&(l.innerHTML=this._escapeHTML(this.field));break;case"input":this._getDomField(!0),this._updateDomField();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"keyup":this._getDomField(!0),this._updateDomField();break;case"cut":case"paste":setTimeout(function(){g._getDomField(!0),g._updateDomField()},1)}var m=f.tree;if(e==m.parentNode)switch(d){case"click":var n=void 0!=a.offsetX?a.offsetX<24*(this.getLevel()+1):a.pageX<c.getAbsoluteLeft(f.tdSeparator);n||h?l&&(c.setEndOfContentEditable(l),l.focus()):k&&(c.setEndOfContentEditable(k),k.focus())}if(e==f.tdExpand&&!h||e==f.tdField||e==f.tdSeparator)switch(d){case"click":l&&(c.setEndOfContentEditable(l),l.focus())}"keydown"==d&&this.onKeyDown(a)},d.prototype.onKeyDown=function(a){var b,f,g,h,i=a.which||a.keyCode,j=a.target||a.srcElement,k=a.ctrlKey,l=a.shiftKey,m=a.altKey,n=!1;if(13==i){if(j==this.dom.value)(!this.editor.mode.edit||a.ctrlKey)&&c.isUrl(this.value)&&(window.open(this.value,"_blank"),n=!0);else if(j==this.dom.expand){var o=this._hasChilds();if(o){var p=a.ctrlKey;this._onExpand(p),j.focus(),n=!0}}}else if(68==i)k&&(this._onDuplicate(),n=!0);else if(69==i)k&&(this._onExpand(l),j.focus(),n=!0);else if(77==i)k&&(this.showContextMenu(j),n=!0);else if(46==i)k&&(this._onRemove(),n=!0);else if(45==i)k&&!l?(this._onInsertBefore(),n=!0):k&&l&&(this._onInsertAfter(),n=!0);else if(35==i){if(m){var q=this._lastNode();q&&q.focus(d.focusElement||this._getElementName(j)),n=!0}}else if(36==i){if(m){var r=this._firstNode();r&&r.focus(d.focusElement||this._getElementName(j)),n=!0}}else if(37==i){if(m&&!l){var s=this._previousElement(j);s&&this.focus(this._getElementName(s)),n=!0}else if(m&&l){if(this.expanded){var t=this.getAppend();g=t?t.nextSibling:void 0}else{var u=this.getDom();g=u.nextSibling}g&&(f=d.getNodeFromTarget(g),h=g.nextSibling,x=d.getNodeFromTarget(h),f&&f instanceof e&&1!=this.parent.childs.length&&x&&x.parent&&(x.parent.moveBefore(this,x),this.focus(d.focusElement||this._getElementName(j))))}}else if(38==i)m&&!l?(b=this._previousNode(),b&&b.focus(d.focusElement||this._getElementName(j)),n=!0):m&&l&&(b=this._previousNode(),b&&b.parent&&(b.parent.moveBefore(this,b),this.focus(d.focusElement||this._getElementName(j))),n=!0);else if(39==i){if(m&&!l){var v=this._nextElement(j);v&&this.focus(this._getElementName(v)),n=!0}else if(m&&l){u=this.getDom();var w=u.previousSibling;w&&(b=d.getNodeFromTarget(w),b&&b.parent&&b instanceof e&&!b.isVisible()&&(b.parent.moveBefore(this,b),this.focus(d.focusElement||this._getElementName(j))))}}else if(40==i)if(m&&!l)f=this._nextNode(),f&&f.focus(d.focusElement||this._getElementName(j)),n=!0;else if(m&&l){f=this.expanded?this.append?this.append._nextNode():void 0:this._nextNode(),g=f?f.getDom():void 0,h=1==this.parent.childs.length?g:g?g.nextSibling:void 0;var x=d.getNodeFromTarget(h);x&&x.parent&&(x.parent.moveBefore(this,x),this.focus(d.focusElement||this._getElementName(j))),n=!0}n&&(a.preventDefault(),a.stopPropagation())},d.prototype._onExpand=function(a){if(a){var b=this.dom.tr.parentNode,c=b.parentNode,d=c.scrollTop;c.removeChild(b)}this.expanded?this.collapse(a):this.expand(a),a&&(c.appendChild(b),c.scrollTop=d)},d.prototype._onRemove=function(){this.editor.highlighter.unhighlight();var a=this.parent.childs,b=a.indexOf(this),c=this.editor.getSelection();a[b+1]?a[b+1].focus():a[b-1]?a[b-1].focus():this.parent.focus();var d=this.editor.getSelection();this.parent._remove(this),this.editor._onAction("removeNode",{node:this,parent:this.parent,index:b,oldSelection:c,newSelection:d})},d.prototype._onDuplicate=function(){var a=this.editor.getSelection(),b=this.parent._duplicate(this);b.focus();var c=this.editor.getSelection();this.editor._onAction("duplicateNode",{node:this,clone:b,parent:this.parent,oldSelection:a,newSelection:c})},d.prototype._onInsertBefore=function(a,b,c){var e=this.editor.getSelection(),f=new d(this.editor,{field:void 0!=a?a:"",value:void 0!=b?b:"",type:c});f.expand(!0),this.parent.insertBefore(f,this),this.editor.highlighter.unhighlight(),f.focus("field");var g=this.editor.getSelection();this.editor._onAction("insertBeforeNode",{node:f,beforeNode:this,parent:this.parent,oldSelection:e,newSelection:g})},d.prototype._onInsertAfter=function(a,b,c){var e=this.editor.getSelection(),f=new d(this.editor,{field:void 0!=a?a:"",value:void 0!=b?b:"",type:c});f.expand(!0),this.parent.insertAfter(f,this),this.editor.highlighter.unhighlight(),f.focus("field");var g=this.editor.getSelection();this.editor._onAction("insertAfterNode",{node:f,afterNode:this,parent:this.parent,oldSelection:e,newSelection:g})},d.prototype._onAppend=function(a,b,c){var e=this.editor.getSelection(),f=new d(this.editor,{field:void 0!=a?a:"",value:void 0!=b?b:"",type:c});f.expand(!0),this.parent.appendChild(f),this.editor.highlighter.unhighlight(),f.focus("field");var g=this.editor.getSelection();this.editor._onAction("appendNode",{node:f,parent:this.parent,oldSelection:e,newSelection:g})},d.prototype._onChangeType=function(a){var b=this.type;if(a!=b){var c=this.editor.getSelection();this.changeType(a);var d=this.editor.getSelection();this.editor._onAction("changeType",{node:this,oldType:b,newType:a,oldSelection:c,newSelection:d})}},d.prototype._onSort=function(a){if(this._hasChilds()){var b="desc"==a?-1:1,c="array"==this.type?"value":"field";this.hideChilds();var d=this.childs,e=this.sort;this.childs=this.childs.concat(),this.childs.sort(function(a,d){return a[c]>d[c]?b:a[c]<d[c]?-b:0}),this.sort=1==b?"asc":"desc",this.editor._onAction("sort",{node:this,oldChilds:d,oldSort:e,newChilds:this.childs,newSort:this.sort}),this.showChilds()}},d.prototype.getAppend=function(){return this.append||(this.append=new e(this.editor),this.append.setParent(this)),this.append.getDom()},d.getNodeFromTarget=function(a){for(;a;){if(a.node)return a.node;a=a.parentNode}return void 0},d.prototype._previousNode=function(){var a=null,b=this.getDom();if(b&&b.parentNode){var c=b;do c=c.previousSibling,a=d.getNodeFromTarget(c);while(c&&a instanceof e&&!a.isVisible())}return a},d.prototype._nextNode=function(){var a=null,b=this.getDom();if(b&&b.parentNode){var c=b;do c=c.nextSibling,a=d.getNodeFromTarget(c);while(c&&a instanceof e&&!a.isVisible())}return a},d.prototype._firstNode=function(){var a=null,b=this.getDom();if(b&&b.parentNode){var c=b.parentNode.firstChild;a=d.getNodeFromTarget(c)}return a},d.prototype._lastNode=function(){var a=null,b=this.getDom();if(b&&b.parentNode){var c=b.parentNode.lastChild;for(a=d.getNodeFromTarget(c);c&&a instanceof e&&!a.isVisible();)c=c.previousSibling,a=d.getNodeFromTarget(c)}return a},d.prototype._previousElement=function(a){var b=this.dom;switch(a){case b.value:if(this.fieldEditable)return b.field;case b.field:if(this._hasChilds())return b.expand;case b.expand:return b.menu;case b.menu:if(b.drag)return b.drag;default:return null}},d.prototype._nextElement=function(a){var b=this.dom;switch(a){case b.drag:return b.menu;case b.menu:if(this._hasChilds())return b.expand;case b.expand:if(this.fieldEditable)return b.field;case b.field:if(!this._hasChilds())return b.value;default:return null}},d.prototype._getElementName=function(a){var b=this.dom;for(var c in b)if(b.hasOwnProperty(c)&&b[c]==a)return c;return null},d.prototype._hasChilds=function(){return"array"==this.type||"object"==this.type},d.TYPE_TITLES={auto:'Field type "auto". The field type is automatically determined from the value and can be a string, number, boolean, or null.',object:'Field type "object". An object contains an unordered set of key/value pairs.',array:'Field type "array". An array contains an ordered collection of values.',string:'Field type "string". Field type is not determined from the value, but always returned as string.'},d.prototype.showContextMenu=function(b,c){var e=this,f=d.TYPE_TITLES,g=[];if(g.push({text:"Type",title:"Change the type of this field",className:"type-"+this.type,submenu:[{text:"Auto",className:"type-auto"+("auto"==this.type?" selected":""),title:f.auto,click:function(){e._onChangeType("auto")}},{text:"Array",className:"type-array"+("array"==this.type?" selected":""),title:f.array,click:function(){e._onChangeType("array")}},{text:"Object",className:"type-object"+("object"==this.type?" selected":""),title:f.object,click:function(){e._onChangeType("object")}},{text:"String",className:"type-string"+("string"==this.type?" selected":""),title:f.string,click:function(){e._onChangeType("string")}}]}),this._hasChilds()){var h="asc"==this.sort?"desc":"asc";g.push({text:"Sort",title:"Sort the childs of this "+this.type,className:"sort-"+h,click:function(){e._onSort(h)},submenu:[{text:"Ascending",className:"sort-asc",title:"Sort the childs of this "+this.type+" in ascending order",click:function(){e._onSort("asc")}},{text:"Descending",className:"sort-desc",title:"Sort the childs of this "+this.type+" in descending order",click:function(){e._onSort("desc")}}]})}if(this.parent&&this.parent._hasChilds()){g.push({type:"separator"});var i=e.parent.childs;e==i[i.length-1]&&g.push({text:"Append",title:"Append a new field with type 'auto' after this field (Ctrl+Shift+Ins)",submenuTitle:"Select the type of the field to be appended",className:"append",click:function(){e._onAppend("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:f.auto,click:function(){e._onAppend("","","auto")}},{text:"Array",className:"type-array",title:f.array,click:function(){e._onAppend("",[])}},{text:"Object",className:"type-object",title:f.object,click:function(){e._onAppend("",{})}},{text:"String",className:"type-string",title:f.string,click:function(){e._onAppend("","","string")}}]}),g.push({text:"Insert",title:"Insert a new field with type 'auto' before this field (Ctrl+Ins)",submenuTitle:"Select the type of the field to be inserted",className:"insert",click:function(){e._onInsertBefore("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:f.auto,click:function(){e._onInsertBefore("","","auto")}},{text:"Array",className:"type-array",title:f.array,click:function(){e._onInsertBefore("",[])}},{text:"Object",className:"type-object",title:f.object,click:function(){e._onInsertBefore("",{})}},{text:"String",className:"type-string",title:f.string,click:function(){e._onInsertBefore("","","string")}}]}),g.push({text:"Duplicate",title:"Duplicate this field (Ctrl+D)",className:"duplicate",click:function(){e._onDuplicate()}}),g.push({text:"Remove",title:"Remove this field (Ctrl+Del)",className:"remove",click:function(){e._onRemove()}})}var j=new a(g,{close:c});j.show(b)},d.prototype._getType=function(a){return a instanceof Array?"array":a instanceof Object?"object":"string"==typeof a&&"string"!=typeof this._stringCast(a)?"string":"auto"},d.prototype._stringCast=function(a){var b=a.toLowerCase(),c=Number(a),d=parseFloat(a);return""==a?"":"null"==b?null:"true"==b?!0:"false"==b?!1:isNaN(c)||isNaN(d)?a:c},d.prototype._escapeHTML=function(a){var b=String(a).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/  /g," &nbsp;").replace(/^ /,"&nbsp;").replace(/ $/,"&nbsp;"),c=JSON.stringify(b);return c.substring(1,c.length-1)},d.prototype._unescapeHTML=function(a){var b='"'+this._escapeJSON(a)+'"',d=c.parse(b);return d.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;|\u00A0/g," ")},d.prototype._escapeJSON=function(a){for(var b="",c=0,d=a.length;d>c;){var e=a.charAt(c);"\n"==e?b+="\\n":"\\"==e?(b+=e,c++,e=a.charAt(c),-1=='"\\/bfnrtu'.indexOf(e)&&(b+="\\"),b+=e):b+='"'==e?'\\"':e,c++}return b};var e=b(d);return d}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(9)],e=function(a){function b(b,c,d){function e(a){b.setMode(a);var c=b.dom&&b.dom.modeBox;c&&c.focus()}for(var f={code:{text:"Code",title:"Switch to code highlighter",click:function(){e("code")}},form:{text:"Form",title:"Switch to form editor",click:function(){e("form")}},text:{text:"Text",title:"Switch to plain text editor",click:function(){e("text")}},tree:{text:"Tree",title:"Switch to tree editor",click:function(){e("tree")}},view:{text:"View",title:"Switch to tree view",click:function(){e("view")}}},g=[],h=0;h<c.length;h++){var i=c[h],j=f[i];if(!j)throw new Error('Unknown mode "'+i+'"');j.className="type-modes"+(d==i?" selected":""),g.push(j)}var k=f[d];if(!k)throw new Error('Unknown mode "'+d+'"');var l=k.text,m=document.createElement("button");return m.className="modes separator",m.innerHTML=l+" &#x25BE;",m.title="Switch editor mode",m.onclick=function(){var b=new a(g);b.show(m)},m}return{create:b}}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(3)],e=function(a){function b(a,b){function c(a,b,e){e.forEach(function(e){if("separator"==e.type){var f=document.createElement("div");f.className="separator",h=document.createElement("li"),h.appendChild(f),a.appendChild(h)}else{var g={},h=document.createElement("li");a.appendChild(h);var i=document.createElement("button");if(i.className=e.className,g.button=i,e.title&&(i.title=e.title),e.click&&(i.onclick=function(){d.hide(),e.click()}),h.appendChild(i),e.submenu){var j=document.createElement("div");j.className="icon",i.appendChild(j),i.appendChild(document.createTextNode(e.text));var k;if(e.click){i.className+=" default";var l=document.createElement("button");g.buttonExpand=l,l.className="expand",l.innerHTML='<div class="expand"></div>',h.appendChild(l),e.submenuTitle&&(l.title=e.submenuTitle),k=l}else{var m=document.createElement("div");m.className="expand",i.appendChild(m),k=i}k.onclick=function(){d._onExpandItem(g),k.focus()};var n=[];g.subItems=n;var o=document.createElement("ul");g.ul=o,o.className="menu",o.style.height="0",h.appendChild(o),c(o,n,e.submenu)}else i.innerHTML='<div class="icon"></div>'+e.text;b.push(g)}})}this.dom={};var d=this,e=this.dom;this.anchor=void 0,this.items=a,this.eventListeners={},this.selection=void 0,this.visibleSubmenu=void 0,this.onClose=b?b.close:void 0;var f=document.createElement("div");f.className="jsoneditor-contextmenu",e.menu=f;var g=document.createElement("ul");g.className="menu",f.appendChild(g),e.list=g,e.items=[];var h=document.createElement("button");e.focusButton=h;var i=document.createElement("li");i.style.overflow="hidden",i.style.height="0",i.appendChild(h),g.appendChild(i),c(g,this.dom.items,a),this.maxHeight=0,a.forEach(function(b){var c=24*(a.length+(b.submenu?b.submenu.length:0));d.maxHeight=Math.max(d.maxHeight,c)})}return b.prototype._getVisibleButtons=function(){var a=[],b=this;return this.dom.items.forEach(function(c){a.push(c.button),c.buttonExpand&&a.push(c.buttonExpand),c.subItems&&c==b.expandedItem&&c.subItems.forEach(function(b){a.push(b.button),b.buttonExpand&&a.push(b.buttonExpand)})}),a},b.visibleMenu=void 0,b.prototype.show=function(c){this.hide();var d=window.innerHeight,e=window.pageYOffset||document.scrollTop||0,f=d+e,g=c.offsetHeight,h=this.maxHeight,i=a.getAbsoluteLeft(c),j=a.getAbsoluteTop(c);f>j+g+h?(this.dom.menu.style.left=i+"px",this.dom.menu.style.top=j+g+"px",this.dom.menu.style.bottom=""):(this.dom.menu.style.left=i+"px",this.dom.menu.style.top="",this.dom.menu.style.bottom=d-j+"px"),document.body.appendChild(this.dom.menu);var k=this,l=this.dom.list;this.eventListeners.mousedown=a.addEventListener(document,"mousedown",function(a){var b=a.target;b==l||k._isChildOf(b,l)||(k.hide(),a.stopPropagation(),a.preventDefault())}),this.eventListeners.mousewheel=a.addEventListener(document,"mousewheel",function(a){a.stopPropagation(),a.preventDefault()}),this.eventListeners.keydown=a.addEventListener(document,"keydown",function(a){k._onKeyDown(a)}),this.selection=a.getSelection(),this.anchor=c,setTimeout(function(){k.dom.focusButton.focus()},0),b.visibleMenu&&b.visibleMenu.hide(),b.visibleMenu=this},b.prototype.hide=function(){this.dom.menu.parentNode&&(this.dom.menu.parentNode.removeChild(this.dom.menu),this.onClose&&this.onClose());for(var c in this.eventListeners)if(this.eventListeners.hasOwnProperty(c)){var d=this.eventListeners[c];d&&a.removeEventListener(document,c,d),delete this.eventListeners[c]}b.visibleMenu==this&&(b.visibleMenu=void 0)},b.prototype._onExpandItem=function(b){var c=this,d=b==this.expandedItem,e=this.expandedItem;if(e&&(e.ul.style.height="0",e.ul.style.padding="",setTimeout(function(){c.expandedItem!=e&&(e.ul.style.display="",a.removeClassName(e.ul.parentNode,"selected"))},300),this.expandedItem=void 0),!d){var f=b.ul;f.style.display="block",f.clientHeight,setTimeout(function(){c.expandedItem==b&&(f.style.height=24*f.childNodes.length+"px",f.style.padding="5px 10px")},0),a.addClassName(f.parentNode,"selected"),this.expandedItem=b}},b.prototype._onKeyDown=function(b){var c,d,e,f,g=b.target,h=b.which,i=!1;27==h?(this.selection&&a.setSelection(this.selection),this.anchor&&this.anchor.focus(),this.hide(),i=!0):9==h?b.shiftKey?(c=this._getVisibleButtons(),d=c.indexOf(g),0==d&&(c[c.length-1].focus(),i=!0)):(c=this._getVisibleButtons(),d=c.indexOf(g),d==c.length-1&&(c[0].focus(),i=!0)):37==h?("expand"==g.className&&(c=this._getVisibleButtons(),d=c.indexOf(g),e=c[d-1],e&&e.focus()),i=!0):38==h?(c=this._getVisibleButtons(),d=c.indexOf(g),e=c[d-1],e&&"expand"==e.className&&(e=c[d-2]),e||(e=c[c.length-1]),e&&e.focus(),i=!0):39==h?(c=this._getVisibleButtons(),d=c.indexOf(g),f=c[d+1],f&&"expand"==f.className&&f.focus(),i=!0):40==h&&(c=this._getVisibleButtons(),d=c.indexOf(g),f=c[d+1],f&&"expand"==f.className&&(f=c[d+2]),f||(f=c[0]),f&&(f.focus(),i=!0),i=!0),i&&(b.stopPropagation(),b.preventDefault())},b.prototype._isChildOf=function(a,b){for(var c=a.parentNode;c;){if(c==b)return!0;c=c.parentNode}return!1},b}.apply(null,d),!(void 0!==e&&(a.exports=e))},function(a,b,c){var d,e;d=[c(9),c(3)],e=function(a,b){function c(c){function d(a){this.editor=a,this.dom={}}return d.prototype=new c,d.prototype.getDom=function(){var a=this.dom;if(a.tr)return a.tr;var b=document.createElement("tr");if(b.node=this,a.tr=b,this.editor.mode.edit){a.tdDrag=document.createElement("td");var c=document.createElement("td");a.tdMenu=c;var d=document.createElement("button");d.className="contextmenu",d.title="Click to open the actions menu (Ctrl+M)",a.menu=d,c.appendChild(a.menu)}var e=document.createElement("td"),f=document.createElement("div");return f.innerHTML="(empty)",f.className="readonly",e.appendChild(f),a.td=e,a.text=f,this.updateDom(),b},d.prototype.updateDom=function(){var a=this.dom,b=a.td;b&&(b.style.paddingLeft=24*this.getLevel()+26+"px");var c=a.text;c&&(c.innerHTML="(empty "+this.parent.type+")");var d=a.tr;this.isVisible()?a.tr.firstChild||(a.tdDrag&&d.appendChild(a.tdDrag),a.tdMenu&&d.appendChild(a.tdMenu),d.appendChild(b)):a.tr.firstChild&&(a.tdDrag&&d.removeChild(a.tdDrag),a.tdMenu&&d.removeChild(a.tdMenu),d.removeChild(b))},d.prototype.isVisible=function(){return 0==this.parent.childs.length},d.prototype.showContextMenu=function(b,d){var e=this,f=c.TYPE_TITLES,g=[{text:"Append",title:"Append a new field with type 'auto' (Ctrl+Shift+Ins)",submenuTitle:"Select the type of the field to be appended",className:"insert",click:function(){e._onAppend("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:f.auto,click:function(){e._onAppend("","","auto")}},{text:"Array",className:"type-array",title:f.array,click:function(){e._onAppend("",[])}},{text:"Object",className:"type-object",title:f.object,click:function(){e._onAppend("",{})}},{text:"String",className:"type-string",title:f.string,click:function(){e._onAppend("","","string")}}]}],h=new a(g,{close:d});h.show(b)},d.prototype.onEvent=function(a){var c=a.type,d=a.target||a.srcElement,e=this.dom,f=e.menu;if(d==f&&("mouseover"==c?this.editor.highlighter.highlight(this.parent):"mouseout"==c&&this.editor.highlighter.unhighlight()),"click"==c&&d==e.menu){var g=this.editor.highlighter;g.highlight(this.parent),g.lock(),b.addClassName(e.menu,"selected"),this.showContextMenu(e.menu,function(){b.removeClassName(e.menu,"selected"),g.unlock(),g.unhighlight()})}"keydown"==c&&this.onKeyDown(a)},d}return c}.apply(null,d),!(void 0!==e&&(a.exports=e))}])});