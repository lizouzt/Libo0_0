/*! elfer_dev_lib 2014-11-17 */
var getXHR=function(){var a=null;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("MSXML2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=null}}}return null!=a&&(a.sendHTTP=function(b){if(a.method=b.method?b.method:"GET",a.url=b.url?b.url:"",a.async=b.async?b.async:!0,a.data=b.data?b.data:"",a.resFormat=b.format?b.format:"json",a.callback=b.callback?b.callback:function(){},a.failback=b.failback?b.failback:function(){},a.result="",a.onreadystatechange=function(){if(4==this.readyState)if(200==this.status||304==this.state)if(this.responseText){try{if("text"!=this.resFormat)var a=JSON.parse(this.responseText);else var a=this.responseText}catch(b){console.log(b.message),this.failback({ret:b.message})}this.callback(a)}else console.log("response empty"),this.failback({ret:"response empty"});else console.log(this.status),this.failback({ret:this.status})},"POST"==a.method.toUpperCase()){var c=a.data.constructor==Object?JSON.stringify(a.data):a.data;a.open(a.method,a.url,a.async),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(c)}else{if(a.data){var d=/\?/.test(a.url),c=a.data;if(c.constructor==Object){var e=d?"":"?";for(key in c)e+=key+"="+c[key]+"&";a.url+=e}else c=c.toString(),a.url+=d?c:"?"+c}a.open(a.method,a.url,a.async),a.send(null)}}),a},cheater=function(){var a="http://yinyueyun.baidu.com/data/cloud/collection",b="http://yinyueyun.baidu.com/data/cloud/songinfo",c="http://yinyueyun.baidu.com/data/cloud/download",d="http://yinyueyun.baidu.com/data/cloud/downloadsongfile?songIds={songIds}&rate={rate}&format={format}";window.favorInfo={songIds:[],songList:{},total:mbox.favorIds.data.total};var e=function(){var e=function(){var b=Math.floor(favorInfo.total/200);favorInfo.total%200!=0&&++b;for(var c=function(b){var d=getXHR();d.sendHTTP({url:a,data:{type:"song",start:b.start,size:200,_:+new Date},callback:function(a){if(a.data.songList){var c=a.data.songList;c.forEach(function(a){favorInfo.songIds.push(a.id)})}b.end&&(console.log("getIds ends."),console.log(favorInfo),g())},failback:function(a){return function(b){console.log("get Ids failed with: "+JSON.stringify(b)),c(a)}}(b)})},d=0;b>d;d++)c({start:200*d,end:d==b-1})},g=function(){var a=getXHR();a.sendHTTP({method:"POST",url:b,data:"songIds="+encodeURIComponent(favorInfo.songIds.join(","))+"&type=&rate=&pt=0&flag=&s2p=&prerate=&bwt=&dur=&bat=&bp=&pos=&auto=",callback:function(a){var b=a.data.songList;if(b&&b.length){var c={};b.forEach(function(a){c[a.songId]=a}),favorInfo.songList=c}console.log("getInfos ends."),console.log(favorInfo),h()},failback:function(a){console.log("get Info failed with: "+JSON.stringify(a))}})},h=function(){var a=0,b=favorInfo.songIds.length,e=setInterval(function(){var g=getXHR(),h=favorInfo.songIds[a];g.sendHTTP({url:c,data:{songIds:h},callback:function(a){return function(b){var c=favorInfo.songList[a],e=b.data.data.flac;e||(e=b.data.data[320]),!!e&&!!c&&(c.flacLink=d.replace(/\{songIds\}/,a).replace(/\{rate\}/,e.rate).replace(/\{format\}/,e.format))}}(h)}),++a,a==b-1&&(clearInterval(e),f(),console.log("end"))},100)};e()},f=function(){var a='<style type="text/css">body{margin:0; padding:0;} h1 a{color: #fff; font-size: 28px;} sub a{color: #fff; font-size: 12px;} h1{background-color: #36465d; color: #fff; font: 900 28px/44px Arial,Helvetica,sans-serif "微软雅黑";} sub{font-size: 12px; font-weight: 400; float: right;} a{font: 900 22px/44px Arial,Helvetica,sans-serif "微软雅黑";height: 44px;margin: 0 12px;text-decoration: none;text-align: center;}</style><h1><a target="_blank" href="http://elferoooh.tumblr.com/">@Elfer </a>2014 <sub>无版权爱运动，停止盗版不如先停止翻唱！<a target="_blank" href="http://weibo.com/u/3966406133">@Borels</a></sub></h1>',b='<a href="{link}" data-id="{id}">{name}---{author}</a>';for(var c in favorInfo.songList){var d=favorInfo.songList[c];d&&d.flacLink&&(a+=b.replace(/\{link\}/,d.flacLink).replace(/\{id\}/,d.songId).replace(/\{name\}/,d.songName).replace(/\{author\}/,d.artistName))}document.write(a)};return{init:function(){e(f)}}}();cheater.init();